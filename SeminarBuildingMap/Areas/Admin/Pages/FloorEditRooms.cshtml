@page "{bdId}/{flNo}"
@model SeminarBuildingMap.FloorEditDisplayModel
@{
    ViewData["Title"] = "addRoomsToMap";
    //allows admin to add/remove rooms or change building info(name)
}
@section Mapping{
    <link rel="stylesheet" href="~/css/leaflet.css" />
    <script src="~/js/leaflet.js"></script>

    <style>
        #mapid {
            height: 750px;
        }
    </style>

    <input id="building" value="@RouteData.Values["bdId"]" type="hidden" />
    <input id="floor" value="@RouteData.Values["flNo"]" type="hidden" />

}

<script>
    function clearText() {
        document.getElementById("coords").textContent = "";
    }
</script>
<div asp-validation-summary="All" class="text-danger"></div>
<ul class="nav nav-tabs" role="tablist">
    <li class="nav-item active"><a class="nav-link active font-weight-bolder" data-toggle="tab" aria-controls="home" aria-selected="true" href="#add">Add Room</a></li>
    <li class="nav-item"><a class="nav-link font-weight-bolder" data-toggle="tab" aria-controls="home" aria-selected="false" href="#edit">Edit Room</a></li>
</ul>
<form method="post">
    <div class="tab-content">
        <div class="tab-pane fade in active show" id="add">
            <input id="coords" type="hidden" asp-for="coords" />
            <button class="btn btn-secondary text-light font-weight-bolder" onclick="clearMarkers()">Restart Room</button>
            <div class="form-group">
                <label>Room Number:</label>
                <input class="form-control" id="newNumber" asp-for="newRmNo" maxlength="10" />
            </div>
            <button type="submit" id="add" class="btn btn-dark text-light font-weight-bolder" asp-page-handler="add" asp-route-bdId="@RouteData.Values["bdId"]" asp-route-flNo="@RouteData.Values["flNo"]">Add Room</button>
        </div>
        <div class="tab-pane fade" id="edit">
            <div class="form-group">
                <label>Selected Room ID:</label>
                <input class="form-control" asp-for="rmId" id="idLabel" readonly />
            </div>
            <div class="form-group">
                <label>Room Number:</label>
                <input class="form-control" asp-for="rmNo" id="numberLabel" maxlength="10" />
            </div>
            <button type="submit" id="update" class="btn btn-dark text-light font-weight-bolder" asp-page-handler="update" asp-route-bdId="@RouteData.Values["bdId"]" asp-route-flNo="@RouteData.Values["flNo"]">Update Room</button>
            <button type="submit" id="delete" class="btn btn-danger text-light font-weight-bolder" asp-page-handler="delete" asp-route-bdId="@RouteData.Values["bdId"]" asp-route-flNo="@RouteData.Values["flNo"]" onclick="return confirm('Are you sure you want to delete this room?')">Delete Room</button>
        </div>
    </div>
</form>


<div id="mapid"></div>
<p>Start with the top left point of a room, and go counter clockwise for the rest of the points to add a room; exactly 4 points must be added</p>
<script src="~/js/AddRoomsMap.js"></script>

<script>
    var rooms = [
    @for(int i = 0; i < Model.Rooms.Count(); i++)
    {

        SeminarBuildingMap.Models.Room room = Model.Rooms.ElementAt(i);
        <text>
        {
            "type": "Feature",
            "properties": { "id": "@room.rmId", "number": "@room.rmNo"},
            "geometry": {
                "type": "Polygon",
                "coordinates": [[[@room.rmTopLeftPoint],[@room.rmBottomLeftPoint],[@room.rmBottomRightPoint],[@room.rmTopRightPoint]]]
                }
        }
        </text>
        @if(i != Model.Rooms.Count() - 1)
        {
            <text>,</text>
        }
    }
        ];

    function style(feature) {
        return {
            fillColor: "Blue"
        };
    }

var geoJson = L.geoJSON(rooms, { style: style, onEachFeature: onEachFeature }).addTo(map);
</script>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

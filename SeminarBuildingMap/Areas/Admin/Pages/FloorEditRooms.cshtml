@page "{bdId}/{flNo}"
@model SeminarBuildingMap.FloorEditDisplayModel
@{
    ViewData["Title"] = "addRoomsToMap";
    //allows admin to add/remove rooms or change building info(name)
}
@section Mapping{
    <link rel="stylesheet" href="~/css/leaflet.css" />
    <script src="~/js/leaflet.js"></script>
    <link rel="stylesheet" href="~/css/L.Control.MousePosition.css" />
    <script src="~/js/L.Control.MousePosition.js"></script>

    <style>
        #mapid {
            height: 750px;
        }
    </style>

    <input id="building" value="@RouteData.Values["bdId"]" type="hidden" />
    <input id="floor" value="@RouteData.Values["flNo"]" type="hidden" />

}

<script>
    function clearText() {
        document.getElementById("coords").textContent = "";
    }
</script>

<ul class="nav nav-tabs" role="tablist">
    <li class="nav-item"><a class="nav-link active" data-toggle="tab" aria-controls="home" aria-selected="true" href="#add">Add Room</a></li>
    <li class="nav-item"><a class="nav-link" data-toggle="tab" aria-controls="home" aria-selected="false" href="#edit">Edit Room</a></li>
</ul>
<form method="post">
    <div class="tab-content">
        <div class="tab-pane fade active" id="add">
            <input id="coords" type="hidden" asp-for="coords" />
            <button class="btn btn-secondary" onclick="clearMarkers()">Restart Room</button>
            <div class="form-group">
                <label>Room Number:</label>
                <input class="form-control" id="newNumber" asp-for="newRmNo" />
            </div>
            <button type="submit" id="add" class="btn btn-primary" asp-page-handler="add" asp-route-bdId="@RouteData.Values["bdId"]" asp-route-flNo="@RouteData.Values["flNo"]">Add Room</button>
        </div>
        <div class="tab-pane fade" id="edit">
            <div class="form-group">
                <label>Selected Room ID:</label>
                <input class="form-control" asp-for="rmId" id="idLabel" readonly />
            </div>
            <div class="form-group">
                <label>Room Number:</label>
                <input class="form-control" asp-for="rmNo" id="numberLabel" />
            </div>
            <button type="submit" id="update" class="btn btn-primary" asp-page-handler="update" asp-route-bdId="@RouteData.Values["bdId"]" asp-route-flNo="@RouteData.Values["flNo"]">Update Room</button>
            <button type="submit" id="delete" class="btn btn-danger" asp-page-handler="delete" asp-route-bdId="@RouteData.Values["bdId"]" asp-route-flNo="@RouteData.Values["flNo"]" onclick="return confirm('Are you sure you want to delete this room?')">Delete Room</button>
        </div>
    </div>
</form>


<div id="mapid"></div>

<script src="~/js/AddRoomsMap.js"></script>

<script>
    var rooms = [
    @for(int i = 0; i < Model.Rooms.Count(); i++)
    {

        SeminarBuildingMap.Models.Room room = Model.Rooms.ElementAt(i);
        <text>
        {
            "type": "Feature",
            "properties": { "id": "@room.rmId", "number": "@room.rmNo"},
            "geometry": {
                "type": "Polygon",
                "coordinates": [[[@room.rmTopLeftPoint],[@room.rmBottomLeftPoint],[@room.rmBottomRightPoint],[@room.rmTopRightPoint]]]
                }
        }
        </text>
        @if(i != Model.Rooms.Count() - 1)
        {
            <text>,</text>
        }
    }
        ];

    function style(feature) {
        return {
            fillColor: "Blue"
        };
    }

var geoJson = L.geoJSON(rooms, { style: style, onEachFeature: onEachFeature }).addTo(map);
</script>


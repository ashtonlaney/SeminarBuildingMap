@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
<!-- mapping section, include this on any page with a map-->
@section Mapping{
    <link rel="stylesheet" href="~/css/leaflet.css" />
    <script src="~/js/leaflet.js"></script>

    <style>
        #mapid {
            height: 750px;
        }
    </style>

    <style>
        #InfoPanelTable th {
            font-size: 1.2rem;
            font-weight: bold;
            white-space: nowrap;
            line-height: 2;
        }
        #InfoPanelTable tr {
            font-size: 1rem;
            font-weight: 400;
        }
    </style>

    <meta http-equiv="refresh" content="60" />

}

<input id="building" asp-for="building" type="hidden" />
<input id="floor" asp-for="floor" type="hidden" />

<div class="row">

    <div class="col-sm-9" style="display:flex; padding-right:0" >
        <h1 id="hMapTitle" class="display-4 font-weight-normal text-dark">@Model.buildingName @Model.floorName</h1>

        <div class="btn-toolbar ml-auto">

            <div class="dropdown mr-2">
                <br />
                <button class="btn btn-dark text-light font-weight-bolder dropdown-toggle" type="button" data-toggle="dropdown">Building</button>
                <div class="dropdown-menu" style="z-index:10000">
                    @for (int i = 0; i < Model.Buildings.Count(); i++) //loop through all buildings and print a list of them
                    {
                        <a class="dropdown-item" href="/?building=@Model.Buildings.ElementAt(i).bdId">@Model.Buildings.ElementAt(i).bdName</a>
                    }
                </div>
            </div>
            <div class="dropdown mr-2">
                <br />
                <button class="btn btn-dark text-light font-weight-bolder dropdown-toggle" type="button" data-toggle="dropdown">Floor</button>
                <div class="dropdown-menu" style="z-index:10000">
                    @for (int i = 0; i < Model.Floors.Count(); i++) //loop through all floors of selected building
                    {
                        <a class="dropdown-item" href="/?building=@Model.building&floor=@Model.Floors.ElementAt(i).flNo">@Model.Floors.ElementAt(i).flName</a>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <!-- DO NOT REMOVE OR MODIFY THE BELOW DIV, THIS IS WHAT THE MAP IS BOUND TO-->
        <div class="col-sm-9" id="mapid"></div>
        <div class="col-sm-3" id="infoPanel">
            <table id="InfoPanelTable" class="table"></table>
        </div>
    </div>
</div>

<!-- pull in the main menu map js file from wwwroot/js/MainMap.js-->
<script src="~/js/MainMap.js"></script>

<script>
    //this bit of code dynamically generates the room javascript on the server side using the model from SQL and the geoJSON is then shipped with the page, this cannot be in a js file, since it uses
    //the model of this page to operate
    //the bits with the 'at' sign before them are razor syntax, its what is ran server side
    var rooms = [
    @for(int i = 0; i < Model.Rooms.Count(); i++)
    {
        Models.Room room = Model.Rooms.ElementAt(i);
        <text>
        {
            "type": "Feature",
            "properties": { "id": "@room.rmId", "color": "@room.Color", "number": "@room.rmNo", "name": "@room.rmName"},
            "geometry": {
                "type": "Polygon",
                "coordinates": [[[@room.rmTopLeftPoint],[@room.rmBottomLeftPoint],[@room.rmBottomRightPoint],[@room.rmTopRightPoint]]]
                }
        }
        </text>
        @if(i != Model.Rooms.Count() - 1)
        {
            <text>,</text>
        }
    }
        ];

    function style(feature) {
        return {
            fillColor: feature.properties.color
        };
    }

var geoJson = L.geoJSON(rooms, { style: style, onEachFeature: onEachFeature }).addTo(map);
</script>